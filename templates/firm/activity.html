{% extends "layouts_new/base.html" %}
{% load i18n bootstrap3 filters %}
{% load static from staticfiles %}


{% block foot_js %}
<script type="application/javascript" src="{% static "js/widgets.js" %}"></script>
<script type="application/javascript">
  $(function () {
    $('#ytdPicker input').datepicker({
      endDate: '0d',
      orientation: 'bottom'
    }).on('changeDate', function(e) {
      $('#id_start').remove();
      $('#id_end').remove();
      $('.activityFilterForm').submit();
    });
    $('#customDatepicker .input-daterange').datepicker({
      endDate: '0d',
      orientation: 'bottom'
    }).on('changeDate', function(e) {
      $('#id_ytd').remove();
      $('.activityFilterForm').submit();
    });;
  });
  function handlePeriodChange(elem) {
    if (elem.value === 'custom') {
      $('#ytdPicker').hide();
      $('#customDatepicker').show();
    } else if (elem.value === 'ytd') {
      $('#customDatepicker').hide();
      $('#ytdPicker').show();
    } else {
      $('#customDatepicker').hide();
      $('#ytdPicker').hide();
      $('#id_ytd').remove();
      $('#id_start').remove();
      $('#id_end').remove();
      elem.form.submit();
    }
  }
  betasmartz.widgets.searchTable("#activity");
</script>
{% endblock %}


{% block main_content %}
  <div class="container">
    <form class="activityFilterForm">
      <div class="row m-t">
        <div class="col-sm-6">
            <h3>View your company activity</h3>
        </div>
        <div class="col-sm-2">
          {% bootstrap_field filter.form.group show_label=False show_help=False %}
        </div>
        <div class="col-sm-2">
          {% bootstrap_field filter.form.verb show_label=False show_help=False %}
        </div>
        <div class="col-sm-2">
          {% bootstrap_field filter.form.period show_label=False show_help=False %}
        </div>
      </div>
      <div class="row">
        <div class="col-sm-2 col-xs-6 col-sm-offset-10" {% if filter.form.period.value == 'ytd' %} style="display: block" {% endif %} id="ytdPicker">
          {% bootstrap_field filter.form.ytd show_label=False show_help=False %}
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4 col-xs-6 col-sm-offset-8" {% if filter.form.period.value == 'custom' %} style="display: block" {% endif %} id="customDatepicker">
          <div class="input-daterange input-group form-group">
            {% bootstrap_field filter.form.start form_group_class='' show_label=False show_help=False %}
            <span class="input-group-addon" style="width: 30px">to</span>
            {% bootstrap_field filter.form.end form_group_class='' show_label=False show_help=False %}
          </div>
        </div>
      </div>
    </form>

    <div class="panel panel-default">
      <div class="table-responsive">
        <table class="table" id="activity">
          <thead>
            <tr>
              <th>#</th>
              <th>User name</th>
              <th>Email</th>
              <th>Date</th>
              <th>Time</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {% for item in filter %}
              <tr>
                <td>{{ item.actor.pk }}</td>
                <td>{{ item.actor.get_full_name }}</td>
                <td><a href="mailto:{{ item.actor.email }}">{{ item.actor.email }}</a></td>
                <td>{{ item.timestamp|date:'d/m/y' }}</td>
                <td>{{ item.timestamp|date:'H:i' }}</td>
                <td>{{ item.verb }}<!-- : {{ item.description }} --></td>
              </tr>
            {% empty %}
              <tr class="text-center">
                <td colspan="5">
                  No entries
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div>
      <a href="">Download Activity as CSV</a>
    </div>
  </div>

{% endblock %}
